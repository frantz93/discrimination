# Coefficients estimés pour les niveaux d'éducation
educ <- tot[4:5,] %>% mutate(label = c("L1: Postsecondary studies below bachelor degree", "L2: Bachelor degree or higher")) %>%
mutate(variable = reorder(variable, estim_coef, FUN = median))
# Coefficients estimés pour les secteurs d'activité
occup <- tot[7:15,] %>% mutate(label = c("S1: Management", "S2: BAF",
"S3: Applied sciences", "S4: Health",
"S5: Education, social serv.",
"S6: Art, culture",
"S8: Trades, transport",
"S9: Agriculture",
"S10: Manufacturing")) %>%
mutate(variable = reorder(variable, estim_coef, FUN = median))
# Coefficients estimés pour les autres variables
other <- tot[c(1:3,6,16:19),] %>% mutate(variable = reorder(variable, estim_coef, FUN = median))
# Graphique des coefficients estimés pour les autres variables
p5 <- other %>% ggplot()
p5 <- p5 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.2) +
theme_economist_white() +
geom_hline(yintercept = 0, col="red") +
scale_x_discrete(name = "") + scale_y_continuous(name="Ln(wage) OLS estimates") +
theme(axis.text.x = element_text(size = 12, angle=60, hjust=1, vjust=1),
axis.text.y = element_text(size = 12)) +
labs(#title = "Structure des salaires au Quebec", #french version
#subtitle = "\n Croissance des salaires vs caractéristiques individuelles \n", #french version
#title = "The wage structure in Quebec",
#subtitle = "\n Impact of individual caracteristics on wage growth \n",
caption = paste0("(*): p-value < 0.001 \n",
"N=", sumreg1$df[2]+sumreg1$df[3], "; df=", sumreg1$df[2],
"; R^2=", round(sumreg1$r.squared,2),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p5
# Graphique des coefficients estimés pour les niveaux d'éducation
p6 <- educ %>% ggplot()
p6 <- p6 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.1) +
geom_point(aes(x = variable, y = estim_coef, col = label), alpha = 0) +
theme(plot.title = element_text(size = 18, face = "bold"), plot.subtitle = element_text(size = 13),
axis.text.x = element_text(size = 12),
axis.text.y = element_text(size = 12),
legend.text = element_text(size = 11), legend.position = "bottom",
panel.grid.major.y = element_line(color = "darkgrey", linetype = "solid"),
panel.grid.minor.y = element_line(colour = "grey50", linetype = "dashed"),
panel.background = element_rect(fill = "white")) +
geom_hline(yintercept = 0, col="red") +
scale_x_discrete(name = "", labels = c("L1", "L2")) +
scale_y_continuous(name="Ln(wage) OLS estimates") + scale_color_discrete(name="") +
labs(#title = "Structure des salaires au Quebec : croissance des salaires vs niveau d'éducation", #french version
#subtitle = "\n Niveau de référence : travailleurs avec éducation secondaire ou inférieure \n", #french version
#title = "Wage structure in Quebec: impact of education on wage growth",
#subtitle = 'Reference: Workers with Secondary education or below',
caption = paste0("(*): p-value < 0.001 \n",
"N=", sumreg1$df[2]+sumreg1$df[3], "; df=", sumreg1$df[2],
"; R^2=", round(sumreg1$r.squared,2),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p6
baseQC.paid <- baseQC %>% filter(ISPAID == 1)  #Filtrage des donnees des salariés au Quebec
reg1 <- lm(LN.SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + IMMIGRANT +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM, data = baseQC.paid)
sumreg1 <- summary(reg1)
conf1 <- data.frame(confint(reg1, level=0.95)) %>% rename(b_inf=X2.5.., b_sup= X97.5..)
# Construction du tableau des résultats de la régression
tot <- data.frame(variable = c("intercept", "YOUNG", "WOMAN", "MARRIED", "EDUC.LEVEL_1","EDUC.LEVEL_2", "IMMIGRANT",
"OCCUP.SEC_1", "OCCUP.SEC_2", "OCCUP.SEC_3", "OCCUP.SEC_4", "OCCUP.SEC_5", "OCCUP.SEC_6", "OCCUP.SEC_8",
"OCCUP.SEC_9", "OCCUP.SEC_10", "PART.TIME", "YRS.TENURE", "SYNDIC", "LARGFIRM"),
estim_coef = sumreg1$coefficients[ , 1], inf = conf1$b_inf,
sup = conf1$b_sup, p_value = sumreg1$coefficients[ , 4]) %>%
mutate(sign = if_else(p_value < 10^-3,"*",if_else(p_value < .05,".",""))) %>%
filter(variable != "intercept")
# Coefficients estimés pour les niveaux d'éducation
educ <- tot[4:5,] %>% mutate(label = c("L1: Postsecondary studies below bachelor degree", "L2: Bachelor degree or higher")) %>%
mutate(variable = reorder(variable, estim_coef, FUN = median))
# Coefficients estimés pour les secteurs d'activité
occup <- tot[7:15,] %>% mutate(label = c("S1: Management", "S2: BAF",
"S3: Applied sciences", "S4: Health",
"S5: Education, social serv.",
"S6: Art, culture",
"S8: Trades, transport",
"S9: Agriculture",
"S10: Manufacturing")) %>%
mutate(variable = reorder(variable, estim_coef, FUN = median))
# Coefficients estimés pour les autres variables
other <- tot[c(1:3,6,16:19),] %>% mutate(variable = reorder(variable, estim_coef, FUN = median))
# Graphique des coefficients estimés pour les autres variables
p5 <- other %>% ggplot()
p5 <- p5 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.2) +
theme_economist_white() +
geom_hline(yintercept = 0, col="red") +
scale_x_discrete(name = "") + scale_y_continuous(name="Ln(wage) OLS estimates") +
theme(axis.text.x = element_text(size = 12, angle=60, hjust=1, vjust=1),
axis.text.y = element_text(size = 12)) +
labs(#title = "Structure des salaires au Quebec", #french version
#subtitle = "\n Croissance des salaires vs caractéristiques individuelles \n", #french version
title = "The wage structure in Quebec",
subtitle = "\n Impact of individual caracteristics on wage growth \n",
caption = paste0("(*): p-value < 0.001 \n",
"N=", sumreg1$df[2]+sumreg1$df[3], "; df=", sumreg1$df[2],
"; R^2=", round(sumreg1$r.squared,2),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p5
# Graphique des coefficients estimés pour les niveaux d'éducation
p6 <- educ %>% ggplot()
p6 <- p6 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.1) +
geom_point(aes(x = variable, y = estim_coef, col = label), alpha = 0) +
theme(plot.title = element_text(size = 18, face = "bold"), plot.subtitle = element_text(size = 13),
axis.text.x = element_text(size = 12),
axis.text.y = element_text(size = 12),
legend.text = element_text(size = 11), legend.position = "bottom",
panel.grid.major.y = element_line(color = "darkgrey", linetype = "solid"),
panel.grid.minor.y = element_line(colour = "grey50", linetype = "dashed"),
panel.background = element_rect(fill = "white")) +
geom_hline(yintercept = 0, col="red") +
scale_x_discrete(name = "", labels = c("L1", "L2")) +
scale_y_continuous(name="Ln(wage) OLS estimates") + scale_color_discrete(name="") +
labs(#title = "Structure des salaires au Quebec : croissance des salaires vs niveau d'éducation", #french version
#subtitle = "\n Niveau de référence : travailleurs avec éducation secondaire ou inférieure \n", #french version
title = "Wage structure in Quebec: impact of education on wage growth",
subtitle = 'Reference: Workers with Secondary education or below',
caption = paste0("(*): p-value < 0.001 \n",
"N=", sumreg1$df[2]+sumreg1$df[3], "; df=", sumreg1$df[2],
"; R^2=", round(sumreg1$r.squared,2),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p6
# Graphique des coefficients estimés pour les secteurs d'activité
p7 <- occup %>% ggplot()
p7 <- p7 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.2) +
geom_point(aes(x = variable, y = estim_coef, col = label), alpha = 0) +
geom_hline(yintercept = 0, col="red") + scale_x_discrete(name = "", labels = c("S10", "S9","S2","S6","S8","S4","S5","S3","S1")) +
scale_y_continuous(name="Ln(wage) OLS estimates") +
scale_color_discrete(name="Sectors") +
theme(plot.title = element_text(size = 18, face = "bold"), plot.subtitle = element_text(size = 13),
axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12),
legend.text = element_text(size = 11), legend.position = "right",
panel.grid.major.y = element_line(color = "darkgrey", linetype = "solid"),
panel.grid.minor.y = element_line(colour = "grey50", linetype = "dashed"),
panel.background = element_rect(fill = "white")) +
labs(#title = "Structure des salaires au Quebec : comparaison des secteurs d'activités", #french version
#subtitle = "\n Niveau de référence : secteur des ventes et services \n", #french version
title = "Wage structure in Quebec: comparing employment sectors",
subtitle = 'Reference level is the sector of Sales and services',
caption = paste0("(*): p-value < 0.001 \n",
"N=", sumreg1$df[2]+sumreg1$df[3], "; df=", sumreg1$df[2],
"; R^2=", round(sumreg1$r.squared,2),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p7
# Tableau de l'ensemble des résultats de la régression
#kable(tot[,], caption = "Impact des variables sur le salaire horaire", "simple")
tot <- tot %>% mutate(estim_coef=round(estim_coef,3), inf=round(inf,3), sup=round(sup,3),
p_value=round(p_value,4))
tot %>% regulartable() %>% autofit() %>% set_caption("Impact des variables sur le salaire horaire") #for fitting PDF doc
#kable(tot, caption = 'Impact des variables sur le salaire horaire', booktabs = TRUE, valign = 't')   #for fitting PDF doc
baseQC.paid$T.IMMIG <- with(baseQC.paid, IMMIGRANT == 1)    #Variables de type 'logical'
results <- oaxaca(formula = SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM | T.IMMIG,
data = baseQC.paid, R = 100)
baseQC.paid$T.IMMIG <- with(baseQC.paid, IMMIGRANT == 1)    #Variables de type 'logical'
results <- oaxaca(formula = SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM | T.IMMIG,
data = baseQC.paid, R = 100)
#Decomposition de l'inégalité salariale (méthode Oaxaca)
#résultat de la décomposition
tab <- data.frame()
tab <- data.frame(n = c(paste("A",results$n$n.A,sep = "\n"),
paste("B",results$n$n.B, sep = "\n"),
paste("pooled",results$n$n.pooled, sep = "\n")),
y = c(paste("A",round(results$y$y.A, 2), sep = "\n"),
paste("B",round(results$y$y.B, 2), sep = "\n"),
paste("diff",round(results$y$y.diff, 2), sep = "\n")),
twofold = c(paste("explained", round(results$twofold$overall[2,2], 2), sep = "\n"),
paste("unexplained", round(results$twofold$overall[2,4], 2), sep = "\n"),
paste0("")),
threefold = c(paste("endowments", round(results$threefold$overall[1], 2), sep = "\n"),
paste("coefficients", round(results$threefold$overall[3], 2), sep = "\n"),
paste("interaction", round(results$threefold$overall[5], 2), sep = "\n")))
#graphique illutrant la discrimination
discrim <- data.frame(gap_type = c("Observed", "Expected", "Unexplained"),
value = c(results$y$y.diff, results$twofold$overall[2,2], results$twofold$overall[2,4]))
p8 <- discrim %>% ggplot(aes(gap_type, value, fill = c("col1", "col2", "col3"))) +
geom_col(width = .95, position = "dodge") +
scale_fill_manual(values = c("col1"="#CC79A7","col2"="#009E73","col3"="#D55E00")) +
scale_x_discrete(name = "Wage Gap", limits=c("Unexplained", "Observed", "Expected")) +
ylab("") +
theme_fivethirtyeight() +
theme(axis.text = element_text(size = 11), legend.position = "none", aspect.ratio = .4,
panel.background =element_rect(fill = "white"), plot.background = element_rect(fill = "white")) +
coord_flip() +
labs(#title = "Structure des salaires au Quebec", #french version
#subtitle = "\n Décomposition de l'écart salarial natifs (A) vs immigrants (B) \n", #french version
title = "The wage structure in Quebec",
subtitle = 'Decomposing the wage gap between Canadian born citizens (A) and Immigrants (B)',
caption = "Method: Blinder-Oaxaca \n \n ©FRPDJ, Source: StatCan_EPA-04/22")
p8
# Tableau détaillé du résultat de la décomposition de l'écart salarial
#kable(tab, caption = "Impact des variables sur le salaire horaire", "simple")
tab %>% flextable() %>% set_caption("Wage decomposition between Canadian born (A) and Immigrant (B)") #for fitting PDF doc
#graphe de la formation des ecarts expliqués par les différences de caractéristiques
p9 <- plot(results, components = c("endowments")) + ggtitle("Impact of workers' characteristics on wage gap")
p9
#graphe de la formation des ecarts expliqués par le modèle
p10 <- plot(results, decomposition = "twofold", group.weight = 1, components = c("explained"),
title = "Impact of workers' characteristics and interactions on wage gap")
p10
#round(results$twofold$variables[[2]][,2:3],3)   #coefficients de la formation des ecarts expliqués par le modèle
# Regression Logit - Chomage
reg2 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + IMMIGRANT + SELF.EMP, family = binomial(link = "logit"), baseQC)
sumreg2 <- summary(reg2)
conf2 <- data.frame(confint(reg2, level=0.95)) %>% rename(b_inf=X2.5.., b_sup= X97.5..)
tot2 <- data.frame(estim_coef = sumreg2$coefficients[ , 1], inf = conf2$b_inf,
sup = conf2$b_sup, p_value = sumreg2$coefficients[ , 4]) %>%
mutate(sign = if_else(p_value < 10^-3, "***", if_else(p_value < 0.01, "**", if_else(p_value < 0.05, "*",
if_else(p_value < 0.1,".",""))))) %>%
mutate(variable = c("intercept", "YOUNG", "WOMAN", "MARRIED", "EDUC.LEVEL_1","EDUC.LEVEL_2", "IMMIGRANT", "SELF.EMP"), .before = 1) %>%
filter(variable != "intercept") %>%
mutate(variable = reorder(variable, estim_coef, FUN = median))
p11 <- tot2 %>% ggplot()
p11 <- p11 + geom_point(aes(x = variable, y = estim_coef), size = 2, col = "darkblue") +
geom_text(aes(x = variable, y = estim_coef, label=sign), nudge_x = .2, nudge_y = 0) +
geom_errorbar(aes(x = variable, y = estim_coef, ymin = inf, ymax = sup), col = "darkblue", width=.2) +
theme_economist_white() +
geom_hline(yintercept = 0, col="red") +
scale_x_discrete(name = "") + scale_y_continuous(name="Logit estimates") +
theme(axis.text.x = element_text(size = 12, angle=60, hjust=1, vjust=1),
axis.text.y = element_text(size = 12)) +
labs(#title = "Les déterminants individuels de la probabilité d'être au chômage au Quebec", #french version
#title = "Individual factors influencing unemployment status in Quebec",
caption = paste0("(***): p-value < 0.001; (**): p-value < 0.01; (*): p-value < 0.05; (.): p-value < 0.1 \n",
"N=", sumreg2$df[2]+sumreg2$df[3], "; df=", sumreg2$df[2],
"; AIC=", round(sumreg2$aic),
"\n \n ©FRPDJ, Source: StatCan_EPA-04/22"))
p11
tot2 <- tot2 %>% mutate(odds = exp(estim_coef))
# Tableau de l'ensemble des résultats de la régression
#kable(tot2[,], caption = "Impact des variables sur la probabilité d'être au chômage", "simple")
tot2 %>% regulartable() %>% autofit() %>% set_caption("Impact des variables sur la probabilité d'être au chômage") #for fitting PDF doc
#Decomposition de l'écart (natif - immigrant) de prob chomage (methode Fairlie)
# 1- Vérification des différences de caractéristiques des natifs (A) vs les immigrants (B)
X.B <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, data = baseQC[baseQC$IMMIGRANT == "1",])
X.A <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, data = baseQC[baseQC$IMMIGRANT == "0",])
prop.A <- apply(X.A, 2, mean)
prop.B <- apply(X.B, 2, mean)
ecartAB <- prop.A - prop.B        #ecart de caracteristiques entre les groupes (natifs - immigrants)
tot3 <- as_tibble(cbind(prop.A, prop.B, ecartAB))
tot3 <- tot3 %>% mutate(variable=c("INTERCEPT","ISUNEMP","YOUNG","WOMAN","MARRIED","EDUC.LEVEL_1","EDUC.LEVEL_2", "SELF.EMP"), .before=1)
# Tableau de l'ensemble des résultats de la régression
#kable(tot3[-1,], caption = "Différences de caractéristiques entre natifs (A) et immigrants (B)", "simple")
tot3[-1,] %>% regulartable() %>% autofit() %>% set_caption("Différences de caractéristiques entre natifs (A) et immigrants (B)") #for fitting PDF doc
tot2 <- tot2 %>% mutate(odds = exp(estim_coef))
# Tableau de l'ensemble des résultats de la régression
kable(tot2[,], caption = "Impact des variables sur la probabilité d'être au chômage", "simple")
#tot2 %>% regulartable() %>% autofit() %>% set_caption("Impact des variables sur la probabilité d'être au chômage") #for fitting PDF doc
# Tableau de l'ensemble des résultats de la régression
kable(tot[,], caption = "Impact des variables sur le salaire horaire", "simple")
#tot <- tot %>% mutate(estim_coef=round(estim_coef,3), inf=round(inf,3), sup=round(sup,3),
#               p_value=round(p_value,4))
#tot %>% regulartable() %>% autofit() %>% set_caption("Impact des variables sur le salaire horaire") #for fitting PDF doc
#kable(tot, caption = 'Impact des variables sur le salaire horaire', booktabs = TRUE, valign = 't')   #for fitting PDF doc
#Decomposition de l'écart (natif - immigrant) de prob chomage (methode Fairlie)
# 1- Vérification des différences de caractéristiques des natifs (A) vs les immigrants (B)
X.B <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, data = baseQC[baseQC$IMMIGRANT == "1",])
X.A <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, data = baseQC[baseQC$IMMIGRANT == "0",])
prop.A <- apply(X.A, 2, mean)
prop.B <- apply(X.B, 2, mean)
ecartAB <- prop.A - prop.B        #ecart de caracteristiques entre les groupes (natifs - immigrants)
tot3 <- as_tibble(cbind(prop.A, prop.B, ecartAB))
tot3 <- tot3 %>% mutate(variable=c("INTERCEPT","ISUNEMP","YOUNG","WOMAN","MARRIED","EDUC.LEVEL_1","EDUC.LEVEL_2", "SELF.EMP"), .before=1)
# Tableau de l'ensemble des résultats de la régression
kable(tot3[-1,], caption = "Différences de caractéristiques entre natifs (A) et immigrants (B)", "simple")
#tot3[-1,] %>% regulartable() %>% autofit() %>% set_caption("Différences de caractéristiques entre natifs (A) et immigrants (B)") #for fitting PDF doc
# 2- Regression logit dans le groupe des natifs (groupe A)
reg4 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, family = binomial(link = "logit"),
data=baseQC[baseQC$IMMIGRANT == "0",])
# 3- On predit les probabilités a partir des estimateurs des natifs (groupe A)
baseQC$pA <- predict(reg4, baseQC, type = 'response')
prop.cB <- mean(baseQC$pA[baseQC$IMMIGRANT == "1"], na.rm = TRUE)      #probabilité que les immigrants soient
#au chômage si leurs caractéristiques sont valorisées comme celles des natifs
expl <- tot3$prop.A[2] - prop.cB #Ecart expliqué
inexpl <- prop.cB - tot3$prop.B[2] #Ecart inexpliqué
# Construction du tableau de résultats
tot4 <- data.frame(gap_type=c("Observed", "Expected", "Unexplained"), value=c(ecartAB[2], expl, inexpl))
# Graphique des résultats
p12 <- tot4 %>% ggplot(aes(gap_type, value, fill = c("col1", "col2", "col3"))) +
geom_col(width = .95, position = "dodge") +
scale_fill_manual(values = c("col1"="#CC79A7","col2"="#009E73","col3"="#D55E00")) +
scale_x_discrete(name = "Wage Gap", limits=c("Unexplained", "Observed", "Expected")) +
ylab("") +
theme_fivethirtyeight() +
theme(axis.text = element_text(size = 11), legend.position = "none", aspect.ratio = .4,
panel.background =element_rect(fill = "white"), plot.background = element_rect(fill = "white")) +
coord_flip() +
labs(#title = "Décomposition de l'écart de probabilité de chômage au Québec", #french version
#subtitle = "\n Natifs (A) vs immigrants (B) \n", #french version
title = "Unemployment rate in Quebec",
subtitle = 'Decomposing the gap between Canadian born citizens (A) and Immigrants (B)',
caption = "Method: Blinder-Oaxaca \n \n ©FRPDJ, Source: StatCan_EPA-04/22")
p12
# Tableau détaillé du résultat de la décomposition de l'écart de probabilité de chômage
#kable(tot4, caption = "The unemployment rate gap: Canadian born (A) vs Immigrant (B)", "simple")
tot4 %>% flextable() %>% set_caption("The unemployment rate gap: Canadian born (A) vs Immigrant (B)") #for fitting PDF
# 2- Regression logit dans le groupe des natifs (groupe A)
reg4 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, family = binomial(link = "logit"),
data=baseQC[baseQC$IMMIGRANT == "0",])
# 3- On predit les probabilités a partir des estimateurs des natifs (groupe A)
baseQC$pA <- predict(reg4, baseQC, type = 'response')
prop.cB <- mean(baseQC$pA[baseQC$IMMIGRANT == "1"], na.rm = TRUE)      #probabilité que les immigrants soient
#au chômage si leurs caractéristiques sont valorisées comme celles des natifs
expl <- tot3$prop.A[2] - prop.cB #Ecart expliqué
inexpl <- prop.cB - tot3$prop.B[2] #Ecart inexpliqué
# Construction du tableau de résultats
tot4 <- data.frame(gap_type=c("Observed", "Expected", "Unexplained"), value=c(ecartAB[2], expl, inexpl))
# Graphique des résultats
p12 <- tot4 %>% ggplot(aes(gap_type, value, fill = c("col1", "col2", "col3"))) +
geom_col(width = .95, position = "dodge") +
scale_fill_manual(values = c("col1"="#CC79A7","col2"="#009E73","col3"="#D55E00")) +
scale_x_discrete(name = "Wage Gap", limits=c("Unexplained", "Observed", "Expected")) +
ylab("") +
theme_fivethirtyeight() +
theme(axis.text = element_text(size = 11), legend.position = "none", aspect.ratio = .4,
panel.background =element_rect(fill = "white"), plot.background = element_rect(fill = "white")) +
coord_flip() +
labs(#title = "Décomposition de l'écart de probabilité de chômage au Québec", #french version
#subtitle = "\n Natifs (A) vs immigrants (B) \n", #french version
title = "Unemployment rate in Quebec",
subtitle = 'Decomposing the gap between Canadian born citizens (A) and Immigrants (B)',
caption = "Method: Blinder-Oaxaca \n \n ©FRPDJ, Source: StatCan_EPA-04/22")
p12
# Tableau détaillé du résultat de la décomposition de l'écart de probabilité de chômage
kable(tot4, caption = "The unemployment rate gap: Canadian born (A) vs Immigrant (B)", "simple")
#tot4 %>% flextable() %>% set_caption("The unemployment rate gap: Canadian born (A) vs Immigrant (B)") #for fitting PDF
tot5 <- cbind(tot3[-c(1:2),], estim_coef=tot2[-6,]$estim_coef, p_value=tot2[-6,]$p_value,
sign=tot2[-6,]$sign)
# Tableau de l'ensemble des résultats de la régression
kable(tot5[,], caption = "Influence des caractéristiques individuelles (natifs(A) vs immigrants(B)) sur les probabilités de chômage", "simple")
#tot5 %>% regulartable() %>% autofit() %>% set_caption("Influence des caractéristiques individuelles (natifs(A) vs immigrants(B)) sur les probabilités de chômage") #for fitting PDF doc
#discrimination salariale
base.paid <- db %>% filter(ISPAID == 1)
base.paid$T.IMMIG <- with(base.paid, IMMIGRANT == 1)    #Variables de type 'logical'
baseBC.paid <- base.paid %>% filter(PROV==59)
baseMB.paid <- base.paid %>% filter(PROV==46)
baseON.paid <- base.paid %>% filter(PROV==35)
resultsBC <- oaxaca(formula = SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM | T.IMMIG,
data = baseBC.paid, R = 100)
resultsMB <- oaxaca(formula = SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM | T.IMMIG,
data = baseMB.paid, R = 100)
resultsON <- oaxaca(formula = SAL ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL +
OCCUP.SEC + PART.TIME + YRS.TENURE + SYNDIC + LARGFIRM | T.IMMIG,
data = baseON.paid, R = 100)
#discrimination dans l'accès emploi
baseBC <- db %>% filter(PROV==59)
baseMB <- db %>% filter(PROV==46)
baseON <- db %>% filter(PROV==35)
# 1- Caractéristiques des natifs (groupe A) vs les immigrants (groupe B)
X.B_BC <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseBC[baseBC$IMMIGRANT == "1",])
X.A_BC <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseBC[baseBC$IMMIGRANT == "0",])
X.B_MB <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseMB[baseMB$IMMIGRANT == "1",])
X.A_MB <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseMB[baseMB$IMMIGRANT == "0",])
X.B_ON <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseON[baseON$IMMIGRANT == "1",])
X.A_ON <- model.matrix(~ ISUNEMP + YOUNG + WOMAN + MARRIED + EDUC.LEVEL, data = baseON[baseON$IMMIGRANT == "0",])
prop.A_BC <- apply(X.A_BC, 2, mean)
prop.B_BC <- apply(X.B_BC, 2, mean)
ecartAB_BC <- prop.A_BC - prop.B_BC        #ecart de caracteristiques entre les groupes (natifs - immigrants)
prop.A_MB <- apply(X.A_MB, 2, mean)
prop.B_MB <- apply(X.B_MB, 2, mean)
ecartAB_MB <- prop.A_MB - prop.B_MB
prop.A_ON <- apply(X.A_ON, 2, mean)
prop.B_ON <- apply(X.B_ON, 2, mean)
ecartAB_ON <- prop.A_ON - prop.B_ON
#round(cbind(prop.A, prop.B, ecartAB), 3)
# Regression logit dans les groupes des natifs (groupe A) des differentes provinces
reg5 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, family = binomial(link = "logit"),
data=baseBC[baseBC$IMMIGRANT == "0",])
reg6 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, family = binomial(link = "logit"),
data=baseMB[baseMB$IMMIGRANT == "0",])
reg7 <- glm(ISUNEMP ~ YOUNG + WOMAN + MARRIED + EDUC.LEVEL + SELF.EMP, family = binomial(link = "logit"),
data=baseON[baseON$IMMIGRANT == "0",])
# Pour chaque province, on prédit les probabilités à partir des estimateurs des natifs (groupe A)
baseBC$pA <- predict(reg5, baseBC, type = 'response')
baseMB$pA <- predict(reg6, baseMB, type = 'response')
baseON$pA <- predict(reg7, baseON, type = 'response')
# Probabilités que les immigrants soient en chômage long si leurs caractéristiques sont valorisées comme celles des natifs, dans les différentes provinces
prop.cB_BC <- mean(baseBC$pA[baseBC$IMMIGRANT == "1"], na.rm = TRUE)
prop.cB_MB <- mean(baseMB$pA[baseMB$IMMIGRANT == "1"], na.rm = TRUE)
prop.cB_ON <- mean(baseON$pA[baseON$IMMIGRANT == "1"], na.rm = TRUE)
#Ecart de proba de chômage long expliqué par les différences de caractéristiques
#expl <- prop.A[2] - prop.cB
expl_BC <- prop.A_BC[2] - prop.cB_BC
expl_MB <- prop.A_MB[2] - prop.cB_MB
expl_ON <- prop.A_ON[2] - prop.cB_ON
#Ecart de proba de chômage long inexpliqué par les modèles
#inexpl <- prop.cB - prop.B[2] #Ecart inexpliqué
inexpl_BC <- prop.cB_BC - prop.B_BC[2]
inexpl_MB <- prop.cB_MB - prop.B_MB[2]
inexpl_ON <- prop.cB_ON - prop.B_ON[2]
tab_all <- data.frame(PROV = c("QC","BC","MB","ON"),
UNEXP_SAL = c(results$twofold$overall[2,4], resultsBC$twofold$overall[2,4],
resultsMB$twofold$overall[2,4], resultsON$twofold$overall[2,4]),
UNEXP_pCHOM = c(inexpl, inexpl_BC,inexpl_MB, inexpl_ON) )
# Graphs
p13 <- tab_all %>% ggplot(aes(UNEXP_pCHOM, UNEXP_SAL, label=PROV)) + geom_point(size=4, aes(col=PROV)) +
ggrepel::geom_text_repel(aes(col=PROV)) +
geom_vline(xintercept = 0) + geom_hline(yintercept = 0) +
scale_x_continuous(limits = c(-0.025, 0.025)) +
scale_y_continuous(limits = c(0, 6)) +
theme_economist_white() +
theme(legend.position = "none", axis.text = element_text(size = 12), legend.text =  element_text(size = 12))+
labs(title = "Labor market discrimination toward immigrants in Canada",
subtitle="\nComparing Quebec to other Provinces\n",
caption = "©FRPDJ, Source:StatCan-04/2022") + geom_mark_circle(aes(filter=PROV!=c("MB","ON")),
fill="lightblue")
p13
# Tableau des résultats
kable(tab_all, caption = "Discrimination entre natifs et immigrants sur le marché du travail au Canada : comparaison entre provinces", "simple")
#tab_all %>% regulartable() %>% autofit() %>% set_caption("Discrimination entre natifs et immigrants sur le marché du travail au Canada : comparaison entre provinces") #for fitting PDF doc
knitr::opts_chunk$set(message=FALSE, warning=FALSE)
options(digits = 8/2, scipen = 00)
library(tidyverse)
library(knitr)
library(flextable)
library(kableExtra)
library(FactoMineR)
library(ggplot2)
library(ggthemes)
library(scales)
library(gridExtra)
library(oaxaca)
library(ggrepel)
library(ggforce)
set_flextable_defaults(fonts_ignore = TRUE, digits = 3)
#Decomposition de l'inégalité salariale (méthode Oaxaca)
#résultat de la décomposition
tab <- data.frame()
tab <- data.frame(n = c(paste("A",results$n$n.A,sep = "\n"),
paste("B",results$n$n.B, sep = "\n"),
paste("pooled",results$n$n.pooled, sep = "\n")),
y = c(paste("A",round(results$y$y.A, 2), sep = "\n"),
paste("B",round(results$y$y.B, 2), sep = "\n"),
paste("diff",round(results$y$y.diff, 2), sep = "\n")),
twofold = c(paste("explained", round(results$twofold$overall[2,2], 2), sep = "\n"),
paste("unexplained", round(results$twofold$overall[2,4], 2), sep = "\n"),
paste0("")),
threefold = c(paste("endowments", round(results$threefold$overall[1], 2), sep = "\n"),
paste("coefficients", round(results$threefold$overall[3], 2), sep = "\n"),
paste("interaction", round(results$threefold$overall[5], 2), sep = "\n")))
#graphique illutrant la discrimination
discrim <- data.frame(gap_type = c("Observed", "Expected", "Unexplained"),
value = c(results$y$y.diff, results$twofold$overall[2,2], results$twofold$overall[2,4]))
p8 <- discrim %>% ggplot(aes(gap_type, value, fill = c("col1", "col2", "col3"))) +
geom_col(width = .95, position = "dodge") +
scale_fill_manual(values = c("col1"="#CC79A7","col2"="#009E73","col3"="#D55E00")) +
scale_x_discrete(name = "Wage Gap", limits=c("Unexplained", "Observed", "Expected")) +
ylab("") +
theme_fivethirtyeight() +
theme(axis.text = element_text(size = 11), legend.position = "none", aspect.ratio = .4,
panel.background =element_rect(fill = "white"), plot.background = element_rect(fill = "white")) +
coord_flip() +
labs(#title = "Structure des salaires au Quebec", #french version
#subtitle = "\n Décomposition de l'écart salarial natifs (A) vs immigrants (B) \n", #french version
title = "The wage structure in Quebec",
subtitle = 'Decomposing the wage gap between Canadian born citizens (A) and Immigrants (B)',
caption = "Method: Blinder-Oaxaca \n \n ©FRPDJ, Source: StatCan_EPA-04/22")
p8
# Tableau détaillé du résultat de la décomposition de l'écart salarial
kable(tab, caption = "Wage decomposition between Canadian born (A) and Immigrant (B)", "simple") %>%
kable_styling()
#tab %>% flextable() %>% set_caption("Wage decomposition between Canadian born (A) and Immigrant (B)") #for fitting PDF doc
# Tableau détaillé du résultat de la décomposition de l'écart salarial
kable(tab, caption = "Wage decomposition between Canadian born (A) and Immigrant (B)", "simple")
#Decomposition de l'inégalité salariale (méthode Oaxaca)
#résultat de la décomposition
tab <- data.frame()
tab <- data.frame(n = c(paste("A",results$n$n.A,sep = "\n"),
paste("B",results$n$n.B, sep = "\n"),
paste("pooled",results$n$n.pooled, sep = "\n")),
y = c(paste("A",round(results$y$y.A, 2), sep = "\n"),
paste("B",round(results$y$y.B, 2), sep = "\n"),
paste("diff",round(results$y$y.diff, 2), sep = "\n")),
twofold = c(paste("explained", round(results$twofold$overall[2,2], 2), sep = "\n"),
paste("unexplained", round(results$twofold$overall[2,4], 2), sep = "\n"),
paste0("")),
threefold = c(paste("endowments", round(results$threefold$overall[1], 2), sep = "\n"),
paste("coefficients", round(results$threefold$overall[3], 2), sep = "\n"),
paste("interaction", round(results$threefold$overall[5], 2), sep = "\n")))
#graphique illutrant la discrimination
discrim <- data.frame(gap_type = c("Observed", "Expected", "Unexplained"),
value = c(results$y$y.diff, results$twofold$overall[2,2], results$twofold$overall[2,4]))
p8 <- discrim %>% ggplot(aes(gap_type, value, fill = c("col1", "col2", "col3"))) +
geom_col(width = .95, position = "dodge") +
scale_fill_manual(values = c("col1"="#CC79A7","col2"="#009E73","col3"="#D55E00")) +
scale_x_discrete(name = "Wage Gap", limits=c("Unexplained", "Observed", "Expected")) +
ylab("") +
theme_fivethirtyeight() +
theme(axis.text = element_text(size = 11), legend.position = "none", aspect.ratio = .4,
panel.background =element_rect(fill = "white"), plot.background = element_rect(fill = "white")) +
coord_flip() +
labs(#title = "Structure des salaires au Quebec", #french version
#subtitle = "\n Décomposition de l'écart salarial natifs (A) vs immigrants (B) \n", #french version
title = "The wage structure in Quebec",
subtitle = 'Decomposing the wage gap between Canadian born citizens (A) and Immigrants (B)',
caption = "Method: Blinder-Oaxaca \n \n ©FRPDJ, Source: StatCan_EPA-04/22")
p8
# Tableau détaillé du résultat de la décomposition de l'écart salarial
kable(tab, caption = "Wage decomposition between Canadian born (A) and Immigrant (B)", "simple")
#tab %>% flextable() %>% set_caption("Wage decomposition between Canadian born (A) and Immigrant (B)") #for fitting PDF doc
